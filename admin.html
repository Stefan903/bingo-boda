<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - Bingo de Boda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
        * { font-family: 'Poppins', sans-serif; }
        
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); } 50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes sparkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .float-animation { animation: float 3s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.5s ease-out forwards; }
        .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradient-shift 8s ease infinite;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .connecting {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            z-index: 100;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Pantalla de conexi√≥n -->
    <div id="connecting" class="connecting">
        <div class="text-center">
            <div class="text-6xl mb-4 sparkle">üî•</div>
            <h2 class="text-2xl font-bold text-purple-900 mb-2">Conectando con Firebase...</h2>
            <p class="text-gray-600">Un momento por favor</p>
        </div>
    </div>

    <!-- Decoraciones flotantes -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-10 left-10 text-6xl opacity-20 float-animation">üíï</div>
        <div class="absolute top-1/4 right-20 text-5xl opacity-20 float-animation" style="animation-delay: 0.5s;">‚ú®</div>
        <div class="absolute bottom-20 left-1/4 text-4xl opacity-20 float-animation" style="animation-delay: 1s;">üéâ</div>
        <div class="absolute bottom-1/3 right-10 text-5xl opacity-20 float-animation" style="animation-delay: 1.5s;">üíç</div>
    </div>

    <div id="mainContent" class="min-h-screen p-4 relative z-10" style="display: none;">
        <div class="max-w-5xl mx-auto">
            <!-- Header principal -->
            <div class="glass-effect rounded-3xl shadow-2xl p-8 mb-6 slide-in">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-4xl sparkle">üëë</span>
                            <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                Panel de Control
                            </h1>
                        </div>
                        <p class="text-xl text-purple-600 font-semibold">Bingo de Boda - Arnick & Paola</p>
                        <p class="text-sm text-gray-500 mt-1">Sincronizaci√≥n en tiempo real ‚ö°</p>
                    </div>
                    <div class="text-right">
                        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-2xl mb-3 pulse-glow">
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-2xl">üë•</span>
                                <span id="playerCount" class="text-2xl font-bold">0</span>
                            </div>
                            <p class="text-xs opacity-90">Jugadores activos</p>
                        </div>
                        <button onclick="resetGame()" class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-2xl hover:shadow-lg transition-all font-semibold">
                            üîÑ Reiniciar Juego
                        </button>
                    </div>
                </div>

                <!-- Secci√≥n de ganadores -->
                <div id="winnersSection" class="hidden mt-6">
                    <div class="bg-gradient-to-r from-yellow-300 via-yellow-400 to-orange-400 rounded-3xl p-6 border-4 border-yellow-500 shadow-2xl slide-in">
                        <div class="flex items-center justify-center gap-3 mb-4">
                            <span class="text-5xl">üèÜ</span>
                            <h2 class="text-3xl font-bold text-white drop-shadow-lg">¬°GANADORES!</h2>
                            <span class="text-5xl">üèÜ</span>
                        </div>
                        <div id="winnersList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="mt-6 grid grid-cols-2 gap-4">
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl p-4 text-center">
                        <div class="text-3xl font-bold text-purple-700" id="activeCount">0</div>
                        <div class="text-sm text-purple-600 font-medium">Preguntas Activas</div>
                    </div>
                    <div class="bg-gradient-to-br from-pink-100 to-pink-200 rounded-2xl p-4 text-center">
                        <div class="text-3xl font-bold text-pink-700">12</div>
                        <div class="text-sm text-pink-600 font-medium">Total Preguntas</div>
                    </div>
                </div>
            </div>

            <!-- Instrucciones -->
            <div class="glass-effect rounded-2xl p-6 mb-6 slide-in" style="animation-delay: 0.1s;">
                <div class="flex items-start gap-3">
                    <span class="text-3xl">üí°</span>
                    <div>
                        <h3 class="font-bold text-gray-800 text-lg mb-2">Instrucciones</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Haz clic en cada pregunta cuando la anuncies al micr√≥fono. Los cambios se sincronizar√°n autom√°ticamente con todos los jugadores en tiempo real.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Grid de preguntas -->
            <div id="questionsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

            <!-- Footer -->
            <div class="glass-effect rounded-2xl p-6 text-center mt-6 slide-in" style="animation-delay: 0.2s;">
                <p class="text-gray-700 font-medium mb-2">
                    üì± Los invitados juegan desde: <span class="font-bold text-purple-600">jugador.html</span>
                </p>
                <p class="text-sm text-gray-500">
                    Comparte el link o c√≥digo QR con los invitados
                </p>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            "Alguien que haya venido desde muy lejos",
            "Alguien que cumple a√±os este mes",
            "Alguien que vino sin acompa√±ante",
            "Alguien que tenga hijos",
            "Alguien que se va a casar pronto",
            "Alguien que ya celebr√≥ 25 a√±os de matrimonio",
            "Alguien que conoci√≥ a Arnick primero",
            "Alguien que conoci√≥ a Paola primero",
            "Alguien que estuvo presente cuando se hicieron pareja",
            "Alguien que llor√≥ durante la ceremonia üíÄ",
            "Alguien que tenga corbata del mismo color que la decoraci√≥n",
            "Alguien que combine colores con su pareja"
        ];

        let database;
        let activeQuestions = new Set();

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyChk6NG_e9KSNL40iDq8fvrnuqsW55ZzrY",
            authDomain: "bingo-boda-arnick-paola.firebaseapp.com",
            databaseURL: "https://bingo-boda-arnick-paola-default-rtdb.firebaseio.com",
            projectId: "bingo-boda-arnick-paola",
            storageBucket: "bingo-boda-arnick-paola.firebasestorage.app",
            messagingSenderId: "40905188995",
            appId: "1:40905188995:web:ef75c57e678ca615195db6"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();

        // Ocultar pantalla de carga y mostrar contenido
        setTimeout(() => {
            document.getElementById('connecting').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }, 1500);

        // Escuchar cambios en preguntas activas
        database.ref('activeQuestions').on('value', (snapshot) => {
            const data = snapshot.val();
            activeQuestions = new Set(data ? Object.keys(data).map(Number) : []);
            createGrid();
        });

        // Escuchar jugadores
        database.ref('players').on('value', (snapshot) => {
            const players = snapshot.val() || {};
            document.getElementById('playerCount').textContent = Object.keys(players).length;
            updateWinners(players);
        });

        function createGrid() {
            const grid = document.getElementById('questionsGrid');
            grid.innerHTML = '';
            
            questions.forEach((question, index) => {
                const isActive = activeQuestions.has(index);
                const button = document.createElement('button');
                button.className = `p-5 rounded-2xl transition-all duration-300 text-left transform hover:scale-105 slide-in ${
                    isActive
                        ? 'bg-gradient-to-br from-purple-500 via-pink-500 to-purple-600 text-white shadow-2xl scale-105'
                        : 'glass-effect text-gray-700 hover:shadow-xl'
                }`;
                button.style.animationDelay = `${index * 0.05}s`;
                button.onclick = () => toggleQuestion(index);
                
                button.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold ${
                            isActive 
                                ? 'bg-white/30 backdrop-blur text-white' 
                                : 'bg-gradient-to-br from-purple-400 to-pink-400 text-white'
                        }">
                            ${isActive ? '‚úì' : index + 1}
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold ${isActive ? 'text-white' : 'text-gray-800'} leading-snug">
                                ${question}
                            </p>
                            ${isActive 
                                ? '<div class="flex items-center gap-1 mt-2"><div class="w-2 h-2 bg-green-300 rounded-full animate-pulse"></div><span class="text-xs text-white/90 font-medium">Activa ahora</span></div>' 
                                : '<p class="text-xs text-gray-500 mt-1">Toca para activar</p>'
                            }
                        </div>
                    </div>
                `;
                
                grid.appendChild(button);
            });
            
            document.getElementById('activeCount').textContent = activeQuestions.size;
        }

        function toggleQuestion(index) {
            if (activeQuestions.has(index)) {
                database.ref(`activeQuestions/${index}`).remove();
            } else {
                database.ref(`activeQuestions/${index}`).set(true);
            }
        }

        function updateWinners(players) {
            const winners = Object.values(players).filter(p => p.hasWon).sort((a, b) => a.winTime - b.winTime);
            const section = document.getElementById('winnersSection');
            const list = document.getElementById('winnersList');
            
            if (winners.length > 0) {
                section.classList.remove('hidden');
                list.innerHTML = winners.map((winner, idx) => `
                    <div class="bg-white rounded-2xl p-4 flex items-center justify-between shadow-lg slide-in" style="animation-delay: ${idx * 0.1}s;">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : 'üéñÔ∏è'}</span>
                            <div>
                                <span class="font-bold text-gray-800 text-lg">${winner.playerName}</span>
                                <p class="text-xs text-gray-500">Ganador #${idx + 1}</p>
                            </div>
                        </div>
                        <span class="text-sm text-gray-600 font-medium">${new Date(winner.winTime).toLocaleTimeString()}</span>
                    </div>
                `).join('');
            } else {
                section.classList.add('hidden');
            }
        }

        function resetGame() {
            if (!confirm('¬øSeguro que quieres reiniciar el juego? Esto borrar√° todo el progreso de todos los jugadores.')) return;
            
            database.ref('activeQuestions').remove();
            database.ref('players').remove();
            alert('‚úÖ ¬°Juego reiniciado exitosamente!');
        }

        // Inicializar grid
        createGrid();
    </script>
</body>
</html>
